<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø­Ø§Ø¯Ø«Ø©</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f7f7f7; padding: 20px; }
    #chat-box { height: 300px; overflow-y: scroll; border: 1px solid #ccc; background: #fff; padding: 10px; }
    .msg { margin: 10px 0; }
    .student { color: blue; }
    .teacher { color: green; }
  </style>
</head>
<body>
  <h3>ðŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
  <div id="chat-box"></div>
  <input type="text" id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§" />
  <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGjFbcG0KGlFPoYt0EP16nIKbK2ci_IQw",
      authDomain: "siraj-74f58.firebaseapp.com",
      databaseURL: "https://siraj-74f58-default-rtdb.firebaseio.com",
      projectId: "siraj-74f58",
      storageBucket: "siraj-74f58.appspot.com",
      messagingSenderId: "60485496189",
      appId: "1:60485496189:web:10dcae7bd8865f91d47014"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Ø§Ù‚Ø±Ø£ roomId Ùˆsender Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· URL
    const urlParams = new URLSearchParams(window.location.search);
    const roomId = urlParams.get('roomId') || 'room_demo123';
    const sender = urlParams.get('user') || 'student'; // student Ø£Ùˆ teacher

    const chatRef = ref(db, "chat_rooms/" + roomId + "/messages");
    const chatBox = document.getElementById('chat-box');

    function sendMessage() {
      const messageInput = document.getElementById('message');
      const message = messageInput.value.trim();
      if (message) {
        push(chatRef, { sender, text: message, timestamp: Date.now() });
        messageInput.value = '';
      }
    }

    onChildAdded(chatRef, snapshot => {
      const msg = snapshot.val();
      const div = document.createElement('div');
      div.className = 'msg ' + msg.sender;
      div.textContent = (msg.sender === 'student' ? 'ðŸ‘¤ Ø·Ø§Ù„Ø¨: ' : 'ðŸŽ“ Ù…Ø¹Ù„Ù…: ') + msg.text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  </script>
</body>
</html>

